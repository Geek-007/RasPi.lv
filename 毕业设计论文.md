# 基于Raspberry Pi的可微信控制的空气质量监控系统

pandoc -o output.docx -f markdown -t docx 毕业设计论文.md

# 摘要

> （最后再写）

# Abstract

> （英文翻译）

# 目录

> （最后自动生成）  

# 第一章 绪论

## 1.1 研究概括

### 1.1.1 项目背景  

>（空气状况与互联网+）人体健康 -> 国内空气环境/室内居家健康环境

在全球变暖和国内工业高速发展的背景下，伴随着人口增长和城镇化的进展，国内空气环境的质量可谓日况愈下。特别是京津冀地区，我国大气污染最严重的区域之一，雾霾状况频发且愈发严重。人类生活离不开空气，空气质量与人体健康的关系密切相关，在政府机构和绿色环保组织的积极宣传和倡导下，公众对国内空气状况的了解和重视程度也越来越深。因此，空气环境状况成为了人民生活的又一热门话题，如何改善空气质量是目前来说最为迫切的环境问题。

随着空气状况的日渐恶化，对空气质量的监控也就变得无比重要，对不同地区的空气进行质量监控，可以为日后的空气状况研究提供数据支持，以便于研究人员能够针对空气质量尽快提出有效的解决方案。而对于个人来说，对家庭居住和出行的周边环境中空气质量的了解和认识也非常重要，这为保护家庭成员的身体健康提供了数据前提和出行保障。而在另一方面，实时掌握家里的环境状态以及家庭险情的自动报警等功能，能够保护全家人的身体健康与财产安全。

### 1.1.2 项目目的

> 创新实践

本项目就是基于日前的国内空气状况所提出的个人解决方案，旨在设计和研究一种可移动性的、快速搭建的、便捷的低成本空气监控设备。在空气监控设备这方面的尝试在国内也尚为少见，据笔者了了解，只有少部分的创业公司想抓住时代的机遇，正尝试于推出空气监控相关的产品。“空气果”就是一款墨迹天气推出的一款智能硬件产品，可以检测空气状况，并能够一键检测，智能体检，甚至于提出推荐解决方案。相当于给大自然戴上一个智能运动手环，凭借硬件来获得大自然的运动数据即空气质量因素。而与此同时，国内热门的互联网手机厂商也在近期推出了小米空气净化器，针对国内的空气污染问题，以满足于消费者所热切需要的室内空气净化功能。

本项目属于创新实践应用，基于国外比较热门的开源硬件Raspberry Pi（中文名：树莓派）进行相关空气传感器和互联网接入等相关扩展，从而有了一套从硬件到软件，线下到线上的物联网解决方案。在软件方面，也从空气传感器数据收集和处理到服务器的搭建、网络应用的开发等方面进行了软件开发研究和实践，完成了一个软硬件结合的综合性应用项目。

### 1.1.3 项目意义

> 低成本的家居解决方案、项目特点（微信）

在本项目中，整套监控系统将围绕着树莓派进行传感器和网络等相关扩展，其重点在于提出一种低成本的家居解决方案。这套解决方案首先可以对室内空气状况进行检测和实现对设备的相关控制，而作为应用创新实践项目，也旨在研究影响空气质量状况的空气因素和相关评定标准和实际项目设计与实践。除此之外，树莓派的扩展能力也远不止于此，还可以将树莓派直接作为网关实现网络服务器的搭建，从而使整套监控系统能够接入互联网，使用户能够直接远程查看该设备所检测到的空气状况和其本身的工作状态，进而操控设备能够在不同的空气状况下做出不同的反应。

并且在此次毕业设计中，笔者还将采用微信作为整套系统的控制终端，借助于微信公众账号打通用户和监控系统的交互路径，能够从微信中直接查看室内空气状况或者跳转到网页获得如数据图表等更为细致的信息。与此同时，探究了移动端产品设计和用户体验等方面人文心理类知识，将之运用到具体的产品开发中也让笔者对全面运用知识的能力得到很大的提升。

## 1.2 发展现状

### 1.2.1 智能家居

> 硬件创业，生活品质，可穿戴

在经历计算机和互联网、移动互联网的兴起之后，物联网被称为信息时代的又一次信息产业技术性革命。随着物联网技术的发展，智能家居应用也将被推向新的发展高度，将智能家居相关设备与互联网连接，可以实现更加丰富的应用模式和场景。近几年物联网设备和应用都如雨后春笋一般层出不穷，国内外都在进行着非常踊跃的尝试与实践，一切的电子设备都开始拥有数据收集和处理能力，将相关数据加以利用可以对人们的生活习惯和生活环境有很大的改善作用。而智能家居作为最贴近于人们的生活起居的一个维度，也是最能够对人们生活产生最大影响的一个环境变量。从而对智能家居中空气环境状况的研究和针对于空气所做的智能监控设备，都是非常有意义和具有前景的方向。

### 1.2.2 互联网+

> 国家政策

在今年3月份，中国政府在工作报告首次提出“互联网+”的行动计划，推动移动互联网、云计算、大数据、物联网等与现代制造业结合，促进电子商务、工业互联网和互联网金融健康发展，引导互联网企业拓展国际市场。目前国家已设立400亿元新兴产业创业投资引导基金，要整合筹措更多资金，为产业创新加油助力。简单地说，“互联网+”就是以互联网平台为基础，利用信息通信技术与各行业进行跨界融合。国务院总理李克强还称，“在互联网+的风口上顺势而为，会使中国经济飞起来。”

在这样的背景之下，互联网对国民的生活甚至于国家经济都已经产生了巨大的影响，国家政府也正式在政策上提出利用互联网拉动经济水平的行动计划。由此可见，智能家居等相关物联网产业必将在新的信息产业发展中前景良好，物联网作为互联网中新兴的一种延展形式，也将会拉动经济水平的进步和国民生活的改善。

### 1.2.3 移动浪潮

> 移动设备剧增、可移动性，便携性

所谓移动互联网，就是将移动通信和互联网二者结合起来，成为一体。随着互联网技术的迅速发展，互联网服务早已延伸到人们的生活日常之中，移动互联网尤甚，可以说很多人在一天的生活中是离不开智能手机的。在移动互联网时代，首先需要考虑的就是，对用户来说，移动设备具有更加易用的可操作性和便捷性，用户也会更加习惯于使用手机等移动设备来接入互联网服务，而另一方面就是基于更多的用户需求，进而可以连接更多的产业领域，将更多的设备接入互联网就可以创造出更多的商业价值。

而在此项目中，笔者也将顺应信息时代的移动浪潮，将监控设备的可控制场景不局限于家庭室内，而是将其接入互联网服务。借助于微信公众账号当下这一热门领域，尽量将用户和产品的距离拉到最近，使之能够使用最便捷的方式来操作和查看整个监控系统。

## 1.3 研究内容

### 1.3.1 主要模块简介

> 硬件软件结合讲，从功能出发

本论文主要研究空气质量监控系统对空气中气体物质含量的实时监控。包括以下内容：

1. 空气传感器的研究与选定：传感器对整套空气质量监控系统的作用就像人的鼻子一样，灵敏度和稳定性是非常重要的。根据国家室内空气质量标准--GB/T18883-2002文件中所定义的对可能影响人体健康以及舒适程度的环境参数，以及结合相关传感器的硬件成本考虑，目前决定采集监控的气体物质包括一氧化碳、烟雾、粉尘和液化气，需要选定不同的传感器对不同的物质进行检测。

2. 树莓派电路板的使用与扩展：树莓派是整套系统的核心硬件，首先是作为控制中心，需要分别控制不同的传感器模块检测空气质量的相关数据，进而对采集到的数据进行具有实际意义的处理分析。再者，树莓派作为软件服务器对整套系统提供运行环境，同时还要处理微信公众号服务器与该系统的数据收发，以及搭建Web应用与网页进行功能性的交互。

3. Linux系统的安装与使用：树莓派可以搭载开源系统Linux，从而对于Linux的学习和使用就必不可少。如何利用Linux系统进行快速高效的开发是本部分内容的关键，主要包括两个方面：服务器的搭建和Web程序的部署和运行，前者将采用标准的WSGI接口来进行设计，后者将采用较为流行的相关技术框架来简化开发流程。

4. 服务器的环境搭建：整套系统的运行环境搭载在基于树莓派的Linux系统中，服务器开发语言为C和Python混合编程，并且会运用HTML+CSS+JavaScript进行相关的Web页面开发，本部分内容就是对服务器的设计与实现，从而将整套系统的代码部署在该服务器上来与外部通信。

5. Web应用开发与实现：监控系统的Web应用服务器直接运行于搭载在树莓派的Linux系统中，用户通过微信公众账号与服务器间接进行功能交互，此部分需要处理微信公众号服务器与本地服务器上所搭载的Web应用所进行的交互，还需要进行开发的开发就是用户在微信中所跳转到的网页功能，该部分的应用功能将利用yeelink平台进行开发实现。

### 1.3.2 章节安排

> 论文的编写安排

在本毕业设计论文中，将主要分为五个章节进行编写，第一部分就是绪论章节，该部分主要介绍本项目的研究概括，包括项目的背景、目的和意义，然后针对国内外的相关产业发展现状进行了分析，主要介绍了物联网背景下的智能家居，政府所提出的“互联网+”政策行动计划，以及在移动浪潮的影响之下本项目的设计趋向，最后对整套监控系统的主要模块进行了简要介绍。第二部分将详细介绍监控系统的总体设计，主要是从应用场景和用户需求出发，注重于系统的的使用产品和相应的功能分析，在完成需求分析之后给出系统的具体实现思路和开发流程，在主控制中心和功能模块化的思想指导下，选择相应的传感器和硬件平台，从而在此基础之上开发软件应用。在第三章中，本论文将详细介绍整套系统的硬件架构，从介绍主控制中心即树莓派开始，分模块解释了传感器硬件的相关设计原理，进而介绍硬件的连接电路和每个模块的作用。主要包括树莓派的GPIO和串口与其他模块的数据传输，以及模数转换模块模拟信号转换为数字信号。第四部分会详细描述监控的本地软件设计，此部分主要关注于在树莓派上对传感器数据的采集和处理，包括操作系统的安装和使用，以及主控制流程的设计与实现，并且在空气数据采集之后进行对数据的实意化处理和有效数据的存储。而后进入最后一部分即第五章，将会详细论述整套系统如何接入互联网，并且与微信公众号和yeelink两个平台进行功能交互，其中包括如何搭建一个WSGI风格的服务器，并将服务器所接入的两个平台上的功能设计和开发都进行了详细介绍。

# 第二章 监控系统的总体设计

## 2.1 系统功能分析

### 2.1.1 应用场景

> 假设场景（起火、雾霾）

在我们的生活中的不同场景里，人们总是会有各种各样的需求出现，不管是基于人性本身的贪痴嗔，亦或是生理和心理上的自然诉求，由此所衍生出来的相应的商业消费品或者科技创新，都在满足着人们对更美好生活的向往，也在无形中影响着我们的世界。有了这样的思考，笔者不由得联想到智能家居在未来生活中所扮演的角色，比如说在回家的路上，拿出手机就可以提前关闭窗户，打开空调降低室内温度，以便于一回到家便可以享受清爽的环境。更可能的是，时刻查看室内空气质量指数，再由此决定是否开启空气净化器净化室内环境，室外的世界在日渐恶化的环境中充斥着雾霾，回到家难道不应该享受一下干净而又安逸的空气吗？而且在家居环境中，一切无形的隐患也在威胁着全家人的身体安全，比如说用户已经进入睡眠，家中却不幸地发生了煤气泄露，如果能够有相应的装置在一探测到液化气就自动发出报警，那可能就可以挽救全家人的性命。又或者出门在外，家里却不幸发生了火灾，如果能够提前发现火情的话，也可以及时得通知消防队前来灭火，保护财产安全。

### 2.1.2 用户需求

> 用户可操控与可查看

在上一节中笔者基于家居环境提出了几种假设的应用场景，对用户来说，身体健康和家庭财产安全是处于首要位置的，如何保证在最适当的时候提供最佳的解决方案也是用户最迫切的需求。最佳解决方案可以分为两种，一种属于用户的主动行为，包括查看信息和控制设备，当用户有了掌控家庭环境的需求的时候，用户可以通过手机终端来直接查看传感器所检测到的具体数据，以及监控系统根据相应的空气质量数据给出的空气状况评定级数。另一种情况属于设备的主动行为，用户被动接受信息。当然如果家中出现紧急情况，监控设备在用户没有进行操作的时候就主动向用户发出警报信息，从而提醒用户查看家中情况并采取相应的措施。除此之外，监控系统也应该具有一定的智能危机处理能力，比如该用户并没有及时看到系统所推送的报警信息，所以监控系统应该要在等待用户采取操作的同时，设置相应的等待阀值，当用户在一定时间内没有响应操作的话，智能系统就应该要主动给出解决方案。系统根据相应的权限和设置的功能可以达到不同的自动化解决能力。比如探测到家中火情发生，系统可以在第一时间打开火灾防护系统，根据火灾发生地点自动选择水的喷洒处，又或者在于此同时，主动通知消防队并且给出详细的家庭位置信息。

## 2.2 系统设计思路

### 2.2.1 主控制中心

> 树莓派的功能介绍：包含硬件上的输入输出/软件上的数据传送与处理，连接互联网

本系统为了能够实现可移动性"采用模块化的设计方式"将系统分为终端采集模块以及控制中心模块"模
块结构图如图 ! 所示

从用户需求出发，整套系统需要完成

### 2.2.2 功能模块化

> 硬件分离GPIO，WiFi连接Internet，软件功能分离

### 2.2.3 传感器的选用

> 根据国家室内空气质量标准，紧跟用户需求
> 
> 环境信息采集，

## 2.3 系统开发流程

### 2.2.1 硬件平台

> 树莓派与传感器，模数转换，网络连接，显示器，网线等等的连接
> 
> 讲到要做的硬件工作，线路图等等

目前，国内外都对智能家居进行了广泛而深入的研究及建设，然而大多数开发组都是自己设计电路、焊接元件，这就将很多非电子专业的电脑爱好者限制在了门外。本文在比较了热门集中集成电路板之后选定了树莓派作为监控系统的硬件平台，并且介绍了以树莓派为中心的空气监控系统的设计与实现，树莓派的使用可以大大降低了普通爱好者及个人开发智能家居的难度。

### 2.2.2 软件开发

> 操作系统的“移植”、服务器搭建、微信连接

# 第三章 监控系统的硬件架构

## 3.1 控制中心硬件设计

### 3.1.1 硬件平台的选择

> 开源硬件的现状，比较各种板子的不同，国内国外，教育目的，个人意义

随着集成电路技术的发展，计算机的体积不断缩小，而各方面的性能也在飞速提高，互联网和智能设备已经逐渐走进人们生产生活的各个领域。物联网和集成电路的快速发展以及人们对居住环境舒适、安全、便捷等要求的不断提高，智能家居、可穿戴设备等的概念已经呼之欲出。而在这个过程当中，基于不同的硬件产品出现过不同硬件平台，以下将分别介绍单片机、Arduino、ARM芯片、树莓派（Raspberry Pi）这几种硬件：

单片机（Microcontrollers）是一种集成电路芯片，是指随着大规模集成电路的出现及其发展，将计算机的CPU、RAM、ROM、定时数器和多种I/O接口集成在一片芯片上，形成芯片级的小而完善的微型计算机系统，为不同的应用场合做不同组合控制。单片机电路主要包括了具有数据处理能力的中央处理器CPU、随机存储器RAM、只读存储器ROM、多种I/O口和中断系统、定时器/计数器等功能模块，当然还可能包括显示驱动电路、脉宽调制电路、模拟多路转换器、A/D转换器等电路。从上世纪80年代，在经过不断的研究和发展，历经4位，8位，到现在的16位及32位，甚至64位。产品的成熟度，以及 投入厂商之多，应用范围之广，真可谓之空前。单片机也由当时的4位、8位单片机，发展到现在的300M的高速单片机。

Arduino是一款便捷灵活、方便上手的开源电子原型平台，包含硬件和软件两部分，Arduino封装了很多函数和大量的传感器函数库，降低了开发难度，即使不懂软件开发和电子的人也可以很快的使用Arduino设计电子产品。从本质上来说，Arduino的内部结构主要就是以AVR单片机为核心控制器的单片机应用开发板，但是Arduino开发人员开发设计了很多简单的函数，还有许多具有相应功能的应用库都能够直接使用，而不用去直接操作单片机底层的寄存器。这使得没有很好的单片机基础的人员也可以使用Arduino做出自己想要的东西。Arduino的开发人员还开发了一个非常简洁的具有图形界面的IDE（集成开发环境），也就是写代码，编译，调试，下载的上位机软件。

ARM就是复杂一点的单片机，而单片机就是ARM的基础。ARM处理器是Acorn计算机有限公司面向低预算市场设计的第一款RISC微处理器。更早称作Acorn RISC Machine。ARM处理器本身是32位设计，但也配备16位指令集，一般来讲比等价32位代码节省达35%，却能保留32位系统的所有优势。但是它和单片机有个本质的区别，单片机是个微型计算机系统，而ARM是个微处理器（仅包含了运算器、控制器，并不包含存储器），在使用的时候就需要给其加上存储器。在应用方面，ARM微处理器可以当做高级单片机直接使用，但为了高效的管理资源（软硬）以及扩展的方面，通常给其运行操作系统，这样就把所有的硬件包装起来，不是很方面直接控制硬件，这里就需要驱动工程师为上层操作系统提供统一的接口。嵌入式广义上来说包含一切和电子有关系的设备，目前来看像DSP、FPGA、ARM都是嵌入式的范畴，但是通常情况下的嵌入式开发，很多都是需要与微处理器操作系统打交道。

Raspberry Pi（中文名为“树莓派”）是为学生计算机编程教育而设计，只有信用卡大小的卡片式电脑，其系统基于Linux。树莓派是一款基于ARM的微型电脑主板，以SD卡为内存硬盘，卡片主板周围有两个USB接口和一个网口，可直接连接键盘、鼠标和网线，同时拥有视频模拟信号的电视输出接口和HDMI高清视频输出接口，以上部件全部整合在一张仅比信用卡稍大的主板上，具备所有PC的基本功能只需接通电视机和键盘，就能执行如电子表格、文字处理、玩游戏、播放高清视频等诸多功能。值得一提的是树莓派使用的是一颗运行在700MHZ的ARM11芯片，可以直接运行完整的操作系统，如Debian等常见Linux发行版。这意味着开发人员可以使用自己最熟练的语言（如Python、Java等）和熟悉的库来进行开发，同时后台运行多个进程也毫无压力。

### 3.1.2 树莓派硬件结构

> 各个集成模块，亮出内部结构图和电路图

前面提到，随着近几年智能手机硬件的发展，廉价而性能足够强劲的移动处理器芯片为树莓派的问世铺平了道路。剑桥大学Eben Upton博士成立了英国树莓派基金会，宣布树莓派的目标为“造价25美元，运行Linux，信用卡尺寸，可以连接电视机，有高清视频播放能力”，基金会推出了这一款旨在推动学校计算机科学教育的信用卡大小的单板电脑。由于其强大的计算能力，丰富的外部扩展，传播广泛社区完善和较为低廉的价格等特点而被选作本毕业设计的硬件开发平台。

下面是树莓派宏观接口图：

`![](http：//guiquanz.me/img/article/raspberrypi/pi-demo.jpg)`

从本质上来说，树莓派其实就相当于是一块电脑主板了，将计算机所需的相关接口都集成到了一块板子上。位居于长方形面板中心的是一块BCM2835片上系统，其上包括了一个ARM1176JZF-s 700Mhz的处理器（可以超频至1Ghz），和一块VideoCore IV GPU， 还有512M RAM（A型板内存为256M）。树莓派上没有内置的长期存储设备，但是板子提供一个SD插槽，可以将烧录好的的SD卡插入作为硬盘使用，SD卡上可以直接运行相应的操作系统。SD插槽的旁边是一个Micro-USB电源插孔，可以由此引入5V的电源，当然比较极端的做法是通过GPIO接口的2号（VCC）和3号（GND）引脚直接提供5V电源。在SD插槽的另一边是26针的扩展接口，其中2脚可以接入或给出5V电源，1脚给出3.3V电源，第12脚可以提供PWM，另外包括一组UART，一组SPI，一组I2C，8个GPIO引脚。树莓派还提供了两种视频接口方式，其一是HDMI，HDMI兼容的电视或者显示器可以直接通过这个接口获得输出的视频信号，VGA显示器则可以通过HDMI-VGA转换器得到VGA信号。其二是位于HDMI相反方向的RCA接口，可以输出模拟视频信号供旧式电视使用。比较明显可以看到的是两个叠在一起的USB接口（A型板只有一个USB接口），可以用来连接鼠标和键盘，但是也总是会遇到USB接口不够用的时候，这是就需要通过一个USB-HUB来进行扩展。在USB接口旁边是一个10/100 M以太网接口，可以用来连接网线连入局域网或者互联网。另外有三个不长用的外设，一个是USB口和RCA接口之间的音响/测试接口；第二个是板子上面的类似于扩展接口的JTAG接口；第三个是TFT触摸屏接口，可以直接接入液晶显示屏。

核心芯片BCM2835：这是博通（Broadcom）公司为树莓派专供的核心芯片，高清嵌入式多媒体应用处理器BCM2835是一种低成本，全高清的多媒体应用处理器，适用于需要高品质多媒体性能的移动和嵌入式应用设备。产品设计充分考虑了电池使用效率，并进行了相关优化。BCM2835还使用博通公司的第四代VideoCore技术来使能应用程序中的各种图像、视频处理。

下面是该芯片的内部结构图：

> 在Dropbox里

*低功耗ARM1176JZ-F 应用处理器
*双核第四代VideoCore多媒体协同处理器
*1080p30帧每秒全高清视编码/解码
*高性能视频输出。1080p60帧每秒持续高分辨率LCD、hdmi输出
*低功耗，高性能OpenGL-ES1.1/2.0VideoCoreGPU
*先进的图像传感器流水线（ISP）长达20万像素的摄像头高达220万像素每秒

这里需要额外提到的是，树莓派在电源上串联了一个自恢复保险（PTC）进去，试图防止出现短路、过流等故障。PTC本来是一种简单的过流保护器件，过流时发热造成内阻上升抵抗过流，异常解除后可以冷却让内阻下降，恢复设备工作。但PTC简单就有简单的问题：PTC自身的电阻不低（实测很可能有0.2Ω以上），串接在电源上容易把电源电压拉下0.3-0.5V左右的程度。这对于5V这个低压来说，电源跌落这个程度就很成问题了，极易造成依赖5V的USB等外设欠压异常。事实上如果供电电压是5.2-5.4等比5V整数稍微高点的规格，那么树莓派得到的电压还可能在5V上。如果电源老老实实提供5V，那树莓派就很可能无法正常供电，笔者最终也是采用了5V、2A的电源适配器为树莓派供电。

## 3.2 采集模块硬件设计

> 每个模块都要讲内部电路和原理，如何使用，空气数据的采集

### 3.2.1 温湿度传感器

数字温湿度传感器DHT11是一款含有已校准数字信号输出的温湿度复合传感器。它应用专用的数字模块采集技术和温湿度传感技术，确保产品具有极高的可靠性与卓越的长期稳定性。传感器包括一个电阻式感湿元件和一个NTC测温元件，并与一个高性能8位单片机相连接。因此该产品具有品质卓越、超快响应、抗干扰能力强、性价比极高等优点。每个DHT11传感器都在极为精确的湿度校验室中进行校准。校准系数以程序的形式储存在OTP内存中，传感器内部在检测信号的处理过程中要调用这些校准系数。单线制串行接口，使系统集成变得简易快捷。超小的体积、极低的功耗，信号传输距离可达20米以上，使其成为各类应用甚至最为苛刻的应用场合的最佳选则。产品为4针单排引脚封装。连接方便，特殊封装形式可根据用户需求而提供。

DHT11模块原理图：

> Dropbox

DHT11 模块接线说明：
- VCC 外接 3.3V-5V
- GND 外接GND
- DATA 小板开关数字量输出接口 接微处理器 IO 口

串行接口 （单线双向）：
DATA 用于微处理器与 DHT11之间的通讯和同步，采用单总线数据格式，一次通讯时间4ms左右，数据分小数部分和整数部分，具体格式在下面说明，当前小数部分用于以后扩展，现读出为零。操作流程如下：

一次完整的数据传输为40bit，高位先出。 

数据格式：8bit湿度整数数据+8bit湿度小数数据+8bi温度整数数据+8bit温度小数数据
+8bit校验和 

数据传送正确时校验和数据等于“8bit湿度整数数据+8bit湿度小数数据+8bi温度整数数据+8bit温度小数数据”所得结果的末8位。

### 3.2.2 可燃性气体传感器

> MQ系列（一氧化碳，液化气）

MQ系列的气体传感器所使用的气敏材料是在清洁空气中电导率较低的二氧化锡（SnO2）。当传感器所处环境中存在可燃气体时，传感器的电导率随空气中可燃气体浓度的增加而增大。使用简单的电路即可将电导率的变化转换为与该气体浓度相对应的输出信号。适用于家庭或工业上对液化气，天然气，煤气的监测装置，具有优良的抗乙醇，烟雾干扰能力。

其中MQ-5气体传感器对丁烷、丙烷、甲烷的灵敏度高，对甲烷和丙烷可较好的兼顾。这种传感器可检测多种可燃性气体，特别是天然气。在较宽的浓度范围内对可燃气体有良好的灵敏度，具有长寿命、低成本，只需要简单的驱动电路即可等特点，主要应用于家庭用气体泄漏报警器，工业用可燃气体报警器，便携式气体检测器。而MQ-2气体传感器对液化气、丙烷、氢气的灵敏度比较高，对可燃气体和烟雾的检测也很理想。结合MQ-2和MQ-5这两种传感器可检测多种可燃性气体，是一款适合多种应用的低成本传感器设计方案。

气体传感器原理图

> 

传感器典型的灵敏度特性曲线

>

图中纵坐标为传感器的电阻比（Rs/Ro），横坐标为气体浓度。Rs表示传感器在不同浓度气体中的电阻值Ro表示传感器在洁净空气中的电阻值。图中所有测试都是在标准试验条件下完成的。 

传感器典型的温度、湿度特性曲线

> 

图中纵坐标是传感器的电阻比（Rs/Ro）。Rs表示在含1000ppm丙烷、不同温/湿度下传感器的电阻值。Ro表示在含1000ppm丙烷、20°C/65%RH环境条件下传感器的电阻值。 

MQ型传感器具有良好的重复性和长期的稳定性。初始稳定，响应时间短，长时间工作性能好。注意在使用前必须先加热一段时间，否则其输出的电阻和电压不准确。其检测可燃气体与烟雾的范围是100-10000ppm（ppm为体积浓度/1ppm = 1立方厘米除以1立方米）。

### 3.2.3 粉尘浓度传感器

粉尘浓度传感器主要用于矿山、水泥厂等粉尘作业场所总粉尘浓度的连续监测。GP2Y1010AU0F是一种基于光学传感系统的灰尘传感器。在该装置中，具有一个红外发光二极管和光电晶体管，对角布置成允许其检测到在空气中的灰尘反射光。其原理如下图，传感器中心有个洞可以让空气自由流过，定向发射LED光，通过检测经过空气中灰尘折射过后的光线来判断灰尘的含量。GP2Y1010AU0F粉尘传感器尤其能够能够有效地检测到非常细的颗粒，如香烟烟雾。此外，它还可以通过区分输出电压的脉冲模式用来判断室内灰尘烟雾。该传感器具有极低的电流消耗（最大20mA，11毫安典型的），可以搭载高达7VDC的传感器。输出的是一个模拟电压正比于所测得的粉尘浓度，敏感性为0.5V/0.1mg/m3。

关于检出方法：

GP2Y1010AU插上电源后1秒内会稳定、正常地运作，可以进行粉尘浓度的对应电压检出。对GP2Y1010AU输出电压的绝对值，并不是判定检出的有无，推荐的使用方法是：无尘时，从输出电压的变化量来做判定。另外，更甚者可以根据输出电平时间上的变化来对检出对象物的种别进行判别。即从输出电平的大小的变化及输出电平时间的变化来看，可以知道检出对象物是什么。

一般，香烟的烟是细微粒子，密度高，会扩散式的大范围漂移。与此相比，灰尘是一个一个大颗粒，密度低，断断续续式的进入灰尘传感器的检出领域。就如下图所述，烟是连续的表现出较高的输出电压，灰尘是间隔的表现出较高的输出电压。因此，根据传感器的输出电压值（发光素子和已同期的脉冲输出电压值）在时间上的推移向微机软件的读取，是否无尘/是否有烟/是否有灰尘，不管是哪种状态，及空气污染的程度是多少，都可以进行检出。

> 图

GP2Y1010AU的内部结构图：

在发射端，需要通过引脚3驱动一个红外发射管，对应后文Arduino程序中定义的LedPower。引脚5为输出，输出的为模拟数据，对应程序中定义的measurePin。根据引脚说明图，还需要在引脚1串联150欧电阻，并并联一个220μF电容。

GP2Y1010AU的引脚说明图：

## 3.3 模数转换模块

### 3.3.1 数字信号与模拟信号

> 举例子讲粉尘传感器的输出信号和树莓派能够读取的信号

我们周围的世界是模拟的。尽管我们可能听说这个世界正在“走向数字化”，但自然绝大部分能观察到的特性在本质上都是模拟的。这个世界可以承载无限多的可能状态，无论是阳光的颜色、海洋的温度还是空气中污染物的浓度。通过模数转换模块可以将这些无穷的可能性离散化为我们喜爱的数字值，这样它们就可以被树莓派这种微控制器系统所分析。如果想让设备与周围的世界交互，就不可避免要使用模拟数据。如果使用一个开关来控制LED的话，开关就是一种数字输入——它只有两种可能的状态：开或关、高或低、1或0，等等。数字化信息（计算机或者树莓派能够处理的信息）是一系列二进制（或数字化）数据。每一位都只能是的两个可能值中的一个。然而，我们身边的世界却很少只使用两种状态来表示信息。看一眼窗外，你看到了什么?如果现在是白天，那么你也许会看到阳光，看到树木在微风中摇摆，抑或是看到川流不息的车辆和人群。你看到的一切都不能轻易地用二进制数据表示。阳光不能以“开”或“关”表示，它的亮度在一天中不断发生变化。类似地，风也不是只有两种状态，其风力无时无刻不在改变。

计算机系统根本无法测量一个具有无穷多小数位的模拟量，这是因为计算机的存储和计算能力都是有限的。那么在这种情况下，怎样才能将树莓派与现实中的“真实世界”连接在一起呢？答案就是模数转换器（analog-to-digital converter，ADC），它可以将模拟量以有限的精度和速度表示为数字量。假设我们需要测定房间的亮度，一个良好的亮度传感器可以产生随房间亮度变化而变化的输出电压。全黑时，设备会输出0V，而在日光下完全饱和时则输出5V，在这之间的电压值的值则表示了各种不同的光照强度。看起来还不错，可是如何才能在树莓派上读取这些数值并计算出房间的亮度呢？这时可以使用模数转换器模块来将模拟电压值转换为数字表示，这样就可以在计算机上处理相应的数值了。

### 3.3.2 PCF8591模块

> 如何与树莓派连接，以及中间的转换工作

PCF8591是一个单片集成、单独供电、低功耗、8-bit CMOS数据获取器件。PCF8591具有4个模拟输入、1个模拟输出和1个串行I2C总线接口。PCF8591的3个地址引脚A0， A1和A2可用于硬件地址编程，允许在同个I2C总线上接入8个PCF8591器件，而无需额外的硬件。在PCF8591器件上输入输出的地址、控制和数 据信号都是通过双线双向I2C总线以串行的方式进行传输。

PCF8951模块原理图

该模块采用PCF8951芯片，支持外部4路电压输入采集（电压输入范围0-5V），模块集成光敏电阻和热敏电阻，可以直接通过AD模块采集环境光强和温度精确数值，该模块还集成了1路0-5V电压输入采集，可以通过蓝色电位器调节输入电压。模块带电源指示灯，对模块供电后指示灯会亮。与此同时，还具有模数转换输出指示灯，当模数转换模块输出接口电压达到一定值，会点亮板上模数输出指示灯，且电压越大，指示灯亮度越明显。

模块接口说明

本模块左边和右边分别外扩2路排针接口，分别说明如下： 

左边：
- AOUT 芯片模数转换模块输出接口
- AINO 芯片模拟输入接口 0 
- AIN1 芯片模拟输入接口 1 
- AIN2 芯片模拟输入接口 2 
- AIN3 芯片模拟输入接口 3

右边：
- SCL IIC时钟接口 接单片机IO口
- SDA IIC数字接口 接单片机IO口 
- GND 模块地 外接地
- VCC 电源接口 外接3.3v-5v

模块共有3个红色短路帽，分别作用如下：
- P4 接上P4短路帽，选择热敏电阻接入电路
- P5 接上P5短路帽，选择光敏电阻接入电路
- P6 接上P6短路帽，选择0-5V可调电压接入电路

注：如果需要使用四路外部电压输入，请将3个红色短路帽都取下

### 3.3.3 Arduino模块

Arduino是一个微控制器开发平台，它配备了直观的编程语言，可以直接使用Arduino集成开发环境（IDE）来开发它。当然也可以为Arduino安装传感器、效应器、灯、扬声器、扩展板及其他集成电路，来将Arduino变成一个可编程的“大脑”，应用于几乎任何控制系统。Arduino Uno是Arduino中的旗舰，在本次毕业设计中将使用这块板卡。它采用了一片16U2 USB-串口转换器芯片，另有一片ATMega 328p作为主MCU。如图所示，下面是一些需要关注的Arduino Uno关键器件：
- Atmel微控制器；
- USB编程/通信接口；
- 稳压器和电源连接；
- 引出的I/O引脚；
- 调试、供电和RX/TX LED；
- 复位按键；
- 在线串行编程器（ICSP）连接器。

每片Arduino的核心都是一个Atmel微控制器单元（MCU）。绝大部分的Arduino板卡，包括Arduino Uno，使用的是一片AVR ATMega 328p微控制器。Arduino编程语言可以用于访问微控制器的外设，包括模数转换器
（ADC）、通用输入/输出（I/O）引脚、通信总线（包括I2C和SPI）及串口。所有这些有用的功能都从微控制器上那些微小的引脚引出到了Arduino上更容易使用的母头连接器上，可以将导线或者扩展板插入其中。一个16MHz的陶瓷谐振器连接到了ATMega的时钟引脚，作为所有程序指令执行的参考。当然，也可以使用复位按键来重启程序。绝大部分Arduino板卡带有一个已经连接到13号引脚的调试LED，这使得能够在不连接额外的电路的情况下运行第一个程序，即让一个LED灯闪烁。

在本文中最关注Arduino上的部分就是通用I/O和模数转换器引脚。所有的这些引脚都可以通过编写的程序来被独立地寻址。它们都可以用作数字输入、输出。ADC引脚还可以作为模拟输入端，用来测定0~5V的电压，由此就可以判定传感器的对空气质量的检测数值。当然在这些引脚中，有许多还可以被复用作其他功能，这些特殊的功能包括各种通信接口、串口、脉冲宽度调制输出及外部中断。

##3.4 硬件的连接

> 都是集成的模块，直接杜邦线连接即可使用，但是要讲原理

### 3.4.1 树莓派GPIO

> 亮出树莓派的各种IO口以及其方面之处

树莓派和普通电脑不一样的地方在于它还带了17个可编程的GPIO（General Purpose Input/Output即通用输入输出接口）连接器，可以用来驱动如传感器，步进电机等其他的硬件设备。既然一个引脚可以用于输入、输出或其他特殊功能，那么一定有寄存器用来选择这些功能。对于输入，一定可以通过读取某个寄存器来确定引脚电平的高低；对于输出，一定可以通过写入某个寄存器来让这个引脚输出高电平或者低电平；对于其他特殊功能，则有另外的寄存器来控制它们。GPIO连接器实际上是由许多不同类型的接口组成的：

- 真正的GPIO（General Purpose Input Output，通用输入/输出）针脚，可以用来控制LED灯的开和关。
- I2C（Inter－Integrated Circuit）接口针脚，能够仅使用2个控制针脚连接硬件模块。
- SPI（Serial Peripheral Interface，串行外设接口）接口用以连接SPI设备，概念上与I2C接口类似，但是标准不同。
- Serial Rx和Tx针脚用于和其他的串行外围设备通信。

另外，一些针脚可被用于PWM（pulse Width Modulation， 脉冲宽度调制）进行电源控制，以及PPM（Pulse Position Modulation，脉冲位置调制）控制马达。

除了供电针脚（包括GND，3.3V和5V），所有的GPIO针脚均可被用于数字输入或输出。作为数字输出，可以通过程序直接切换某些针脚的高低电平，如果置为3.3V就是高电平，0V就是低电平。如果使用针脚作为数字输入，则可以把开关和简单的传感器连到一个针脚上然后检查它是否打开或关闭，也就是是否激活。当然，如果是传感器等模拟信号，则需要通过ADC（即模数转换器）进行转化。标记为SCL和SDA的针脚可被用于I2C。标记为MOSI，MISO和SCKL的针脚可以用于连接高速SPI设备。需要注意的是，当从树莓派的GPIO接口上读取数据时，实际上是在检查这个and接口是被接在3.3V电源（高电平）上还是被接地（低电平）了。必须牢记，输入接口必须连接一个确定的信号（3.3V或接地），如果尝试读取一个即未接电源又未接地的引脚，将会得到一个不稳定的信号。所有针脚有一个3.3V的逻辑电平但是并不是5V安全的，所以输出电平是O-3.3V并且输入电平也不应高于3.3V。如果想要连接5V的输出电平作为树莓派的输入电平，这是就需要使用一个电平位移器。

### 3.4.2 I2C总线

> 数据口的工作原理，时序啥的

I2C（Inter－Integrated Circuit）总线是由荷兰菲利浦公司于80年代研制开发的两线式串行总线，用于连接微控制器及其外围设备。现已成为微电子通信控制领域广泛采用的一种总线标准，它是同步通信的一种特殊形式，具有接口线少，控制方式简单，器件封装形式小，通信速率较高等优点。I2C总线支持任何IC生产过程（CMOS、双极性），主要由双向串行时钟线SCL和双向串行数据线SDA两条线路组成，通过串行数据（SDA）线和串行时钟（SCL）线在连接到总线的器件间传递信息。每个器件都有一个唯一的地址识别（无论是MCU即微控制器、LCD驱动器、存储器或键盘接口），而且都可以作为一个发送器或接收器（由器件的功能决定）。LCD 驱动器只能作为接收器，而存储器则既可以接收又可以发送数据。除了发送器和接收器外，器件在执行数据传输时也可以被看作是主机或从机。主机是初始化总线的数据传输并产生允许传输的时钟信号的器件。此时，任何被寻址的器件都被认为是从机。

2C总线主要在微处理器的控制之下，因此通常称微处理器是I2C总线的主机。习惯上总称受控设备及功能电路为I2C总线的从机。这种主机与从机之间的连接通常是在总线的输出端，而输出端的电路结构为IIC总线的从机。这种主机与从机之间的连接通常是在总线的输出端，而输出端的电路结构又总是开漏输出或集电极开路输出。通常数据传送要由主机发出启动信号和时钟信号，向所控从机发出一个地址、一个读写位和一个应答位，其中地址位为7位数据，在实际控制中，一般一次只能传送一个8位数据，并以一个停止位结束。　　在实际应用中，往往被传送的数据位数会超过8位，也就是说总会有多字节传送，这时必须在传送数据地址结束后再传送一个副地址。因此，被传送的字节没有限制，但每一个字节后面必须有一位应答位。应答位通常被设定在低电平，当应答位处于高电平时，指示被传送的数据已结束。

I2C总线与传统的PWM调宽脉冲相比较，其最大的特点是串行数据线和时钟线都是双向传输线。I2C总线在实际电路的应用中，两根线各自通过一个上拉电阻连接到电源电压的正极端，当总线空闲时，数据线SDA和时钟线SCL必须保持高电平，同时各接口电路的输出又必须是开路漏极或开路集电极，因此I2C总线的最大特性是在地址信息传输过程中，即可以是主控器也可以是被控器，或既可以是发射器又可以是接收器，从而为挂在总线上的各集成电路或功能模块完成各自的功能提供了极大方便。

如果I2C总线用作主控器电路即微处理电路，则在总线上将提供时钟传送及初始化的数据传输，而控制数据信息传送的对象、方向及传送的终止也由主控器来决定。在I2C总线上被主控器所寻址的集成电路或功能模块，称之为被控器。在I2C总线上，被控器每接收一个“数码”后都要在数据线上给主控器发送一个识别应答信号，以示完成一个控制功能。因此，I2C总线具有十分灵活的运用性。

在本毕业设计论文中，将通过I2C总线连接树莓派和PCF8591模数转换模块，PCF8591具有1个串行I2C总线接口，SCL口接树莓派P1的5脚，对应树莓派的I2C1_SCL口；SDA口接树莓派P1的3脚，对应树莓派的I2C1_SDA口。

### 3.4.3 UART串口

> 介绍如何使用树莓派的串口连接Adrniuo，以及传输数据的原理

所谓通信协议是指通信双方的一种约定。一条信息的各位数据按照逐位按顺序的约定进行传送的通讯方式称为串行通讯。串行通讯的特点是：数据位传送，传按位顺序进行，最少只需一根传输线即可完成，成本低但送速度慢。串行通讯的距离可以从几米到几千米。根据信息的传送方向，串行通讯可以进一步分为单工、半双工和全双工三种。串行接口是一种可以将接受来自CPU的并行数据字符转换为连续的串行数据流发送出去，同时可将接受的串行数据流转换为并行的数据字符供给CPU的器件。简而言之，串行端口是CPU与串行设备间的编码转换器，当CPU经过串行端口发数据时，字节数据列队成串行位，串行端口接收数据时，串行位转换成字节数据，所以必须安装相应的驱动程序。

Arduino与树莓派通过串口通信的方式实现通信，相互传输所需要的数据，树莓派将资源传于互联网上对应的接口，接口可以在互联网上被访问。Arduino与Raspberry通过串口通信的方案一般有两种，通过树莓派GPIO串口直接通信，当然还有通过Arduino的USB转串口进行通信。树莓派的GPIO外部接口中含有一路UART串行接口，利用该接口可以实现树莓派与Arduino、GPRS模块、GPS等其他外部系统的对接。但是由于树莓派与Arduino的串口电平不一致，即树莓派输入输出电压为3.3v，而Arduino IO口电压为5V，所以必须使用电平转换芯片，或串联电阻限流，否则有可能损坏树莓派IO口。显然，通过USB通信会比GPIO通信高效稳定得多，同时使用起来也比较方便。由于笔者将使用Arduino自带的USB转串口，因此必须给树莓派安装其驱动，而驱动就在arduino提供的软件上，所以必须在树莓派上直接安装Arduino软件即集成开发环境。

### 3.4.4 硬件电路结构

> 亮出电路图（比较Q型）

# 第四章 监控系统的本地软件设计

## 4.1 操作系统的安装与使用

### 4.1.1 Linux内核简介

> Linux的起源与发展，以及其不同的发行版，参考（一步步搭建物联网）

Linux是一种自由和开放源码的类UNIX操作系统内核，是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统。它能运行主要的UNIX工具软件、应用程序和网络协议。它支持32位和64位硬件。Linux继承了Unix以网络为核心的设计思想，是一个性能稳定的多用户网络操作系统。目前存在着许多不同的Linux发行版，可安装在各种各样的电脑硬件设备，从手机、平板电脑、路由器和影音游戏控制台，到桌上型电脑，大型电脑和超级电脑。Linux是一个领先的操作系统内核，世界上运算最快的10台超级电脑运行的都是基于Linux内核的操作系统。

Linux得名于电脑业余爱好者Linus Torvalds。Linux操作系统也是自由软件和开放源代码发展中最著名的例子。只要遵循GNU通用公共许可证,任何人和机构都可以自由地使用Linux的所有底层源代码，也可以自由地修改和再发布。严格来讲，Linux这个词本身只表示Linux内核，但在实际上人们已经习惯了用Linux来形容整个基于Linux内核，并且使用GNU工程各种工具和数据库的操作系统（也被称为GNU/Linux）。通常情况下，Linux被打包成供台式或笔记本电脑和服务器使用的Linux发行版本。一些流行的主流Linux发行版本，包括Debian（及其衍生版本Ubuntu），Fedora和openSUSE等。

### 4.1.2 安装Raspbian系统

> 介绍如何为树莓派安装操作系统

树莓派相比于一般的ARM开发板来说，由于其本身搭载着Linux操作系统，可以用诸如Python、Ruby或Bash来执行脚本，而不是通过编译程序来运行，因此具有更高的开发效率。

笔者为树莓派选用的是官方提供的Raspbian即官方推荐使用的Raspberry Pi专用Debian版本。到官方网站打开下载页后，选择Raspbian “wheezy”下载最新版。将zip文件解压缩后会得到一个.img镜像文件，将其写入SD卡即可作为树莓派的系统。首先下载安装SD Formatter 4.0 for SD/SDHC/SDXC和win32DiskImager这两款软件，前者用来格式化SD卡，后者加载镜像为SD卡烧录系统。需要注意的是一定要选择SD卡所在的盘符，避免不恰当的操作导致笔记本硬盘数据丢失。写入完毕之后，为了使用方便还需要修改SD卡的配置文件内容，首先要修改SD卡是cmdline.txt文件，在最开始加入语句ip=192.168.31.183，就可以将树莓派设置成静态IP地址，到时候就可以很方便得通过这个地址连接到树莓派。

至此，树莓派的系统已经安装到SD卡，将其插入树莓派的SD卡插槽。但是在连接到树莓派需要说明的一点是，树莓派的供电电源需要使用2A的电源适配器，普通的智能手机充电器只有1A，可能会导致电源供电出现问题。另外一个问题是，在连接外接显示器的时候，由于树莓派只有HDMI而没有VGA接口，此时需要准备一个HDMI-VGA转接线，而且必须是有源的HDMI转接线，即需要有外接电源，否则有可能烧坏二极管。当然，可能是由于笔者使用的是5V、2A的电源，直接使用无源的HDMI转接线也是没有问题的。连接好鼠标键盘之后，启动电源，便可以进入到树莓派的开机界面。

开机之后需要对树莓派的进行第一次配置，树莓派内置一个名为“Raspi-Config”的配置工具，它会在第一次启动树莓派时自动运行。它会在桌面系统运行前启动，所以需要使用方向键和回车键来定位菜单系统。这有点像调整PC的BIOS设置。一旦配置正确，可能以后都不再需要配置第二次了。首先树莓派默认只使用操作系统需要的SD卡空间。这意味着即使有一个很大容量的SD卡，操作系统也不会使用那么多容量。由于笔者需要在Raspbian系统上安装软件和运行程序，则必须将SD卡的所有空间都得以使用，使用上/下方向键选择“expand_roofts”菜单项然后敲一下回车。之后可以通过修改“overscan”来设置全屏、修改“change_timezone”设置时区、修改“boot_behaviour”设置树莓派自动登录并且启动到桌面环境，另外需要修改的是“ssh”，这个选项将打开ssh使外部网络能够对树莓派进行远程操作，即从另一台计算机上控制树莓派。

设置完毕，点击“Finish”便可以进入到树莓派的桌面环境了，如果在之后的时间里需要改变某些配置，可以点击桌面上的”LXTerminal”图标打开一个新终端，在任何时候运行sudo raspi-config命令即可进入之前的配置页面。

- 下载必备软件：Raspbian系统，Windows下的格式化工具，烧录SD卡工具
- 修改系统的配置文件（静态IP，分辨率）
- 注意电源，接入鼠标键盘，图形界面设置（SSH、时区、中文等等）
- 无线网卡设置，自动连接WiFi、三种方式（网线-路由器，网线-电脑，无线网卡-显示器）
- 安装和开机启动VNC，即远程桌面
- SFTP远程传输树莓派文件

### 4.1.3 网络配置流程

由于树莓派的性能不足以流畅运行桌面环境，而且鼠标、键盘和显示器等外接设备也占用了本来就少的硬件接口，所以本节将介绍如何配置树莓派接入网络，从而通过远程操作的方式来控制树莓派。

如果已经成功运行且进入了树莓派的桌面环境，则可以插入USB无线网卡，笔者使用的是EDUP厂商的EP-N8508GS型号。最新的Raspbian和Occidentalis已经原生支持这个芯片，无须安装驱动即可使用，并且它的速度也比较快。这时会有一个问题就是把无线网卡插到树莓派之后，那就只剩一个USB口可以用来接键盘或鼠标了，因此需要额外的USB扩展，但必须是一个有源的USB Hub才可以。由于笔者没有买有源USB Hub，直接是采用了鼠标、键盘轮流插拔的方式来操作树莓派。

首先介绍如何通过图形界面进行无线网的配置，Raspbian系统都带有一个WiFi配置工具，可以直接在桌面上找到一个“WiFi Config”的快捷方式，具体配置详情就不再赘述。当然，也可以使用命令行工具通过以太网登录，手动编辑/etc/network/interfaces即可：sudo nano /etc/network/interfaces。

在将树莓派接入网络之后，由于笔者在安装完毕的SD卡cmdline.txt文件中已经设置了树莓派的静态IP，所以直接使用该IP地址访问到树莓派。但与此同时，如果没有完成之前的设置可以通过以下几种方式找到树莓派的IP地址。第一种是直接使用命令行来查找，打开一个LXTerminal终端窗口并且键入下面的命令：sudo ifconfig，便可以在wlan0旁边看到树莓派的IP地址192.168.31.183。需要注意的是，如果树莓派的IP地址以192.168或者10.0开头，那么这是一个内网地址，它意味着树莓派可以访问因特网但是内部网络以外的其他用户是无法通过这个IP直接访问到树莓派的。所以在接下的工作中，需要把树莓派作为一个能从外网访问的网页服务器。而把树莓派放在内网中再通过内网穿透的方式接入外网，那它就会更加安全一些而不会被轻易黑掉。

但是，如果没能进入树莓派的图形界面该如何走到树莓派的IP地址并且操作树莓派呢，首先比较简单的方式是将树莓派通过以太网接口使用网线连接至路由器，在路由器里可以为树莓派所对应的Mac地址保留一个固定的IP地址。由于开发人员对树莓派所接入的网络的路由器有完全的控制权，通过DHCP（动态主机设置协议）为所绑定的设备分配静态IP。当然，如果是通过无线网卡的方式连接到路由器的话也是一样的，可以直接在路由器后台为树莓派绑定一个静态IP，以便于之后的操作。

通过一根网线也可以直接将树莓派和笔记本电脑进行连接，连接之后可以通过扫描软件PortScan扫描到树莓派的IP地址。如果笔记本已经通过WIFI连接到互联网，另一种方式就是将无线网卡的互联网资源共享给本地连接。然后运行DOS窗口，输入arp -a，在接口下显示为动态类型的IP地址就是树莓派的地址。

### 4.1.4 远程操控树莓派

上一节中笔者已经将树莓派接入互联网且已知树莓派的动态IP地址或者设置好的静态IP，下面将介绍两种无显示器远程操控树莓派的方式：SSH和VNC。前者是命令行，后者是图形界面。如果熟悉命令行下的Linux系统的话，SSH已经足够使用了。SSH指的就是Secure Shell，这是Linux系统的一个功能可以直接从主机电脑上快速打开一个树莓派的终端会话。如果使用的是Mac或者Linux计算机的话，可以直接在终端窗口输入下面的命令：ssh 192.168.31.183 -l pi，参数“-l pi”的意思是将使用“pi”作为用户名登录到树莓派上。第一次运行这个命令，将会得到一个安全警告关于不能确认该机器的身份，输入密码（默认是“raspberry”）进行树莓派的命令行操作页面。在Windows电脑中，需要下载一个叫做“putty”的免费软件，通过putty软件输入树莓派ip，默认端口22，点击open就会连接到树莓派，同样需要输入用户名和密码。为了使用更方便，可以通过命令启用root用户，命令为：sudo passwd root，这是设置root账号的密码，需要输入两次新密码，然后再启用root用户登录，命令为：sudo passwd –unlock root。执行完之后，使用reboot命令重启就可以使用root用户登录，不需要每次打开终端都要求输入密码。

然后我们需要通过SSH为树莓派安装VNC软件，VNC（Virtual Network Connection）是一种可视化网络连接的标准，通过VNC可以就可以远程访问和操作树莓派的图形界面。打开先前已经建立好的SSH连接就可以为树莓派安装VNC server，并且设置好开机自启动，还调整VNC屏幕的尺寸。与此同时，需要在Windows下也安装一个VNC客户端，笔者使用的是“VNC Viewer”，输入树莓派的IP地址:1（意味着端口号）点击连接，输入树莓派上的VNC server的密码就会弹出VNC窗口。

有时候需要在树莓派和笔记本电脑直接互传文件，可以使用SFTP远程传输树莓派文件，下载安装FileZilla，在“快速连接”中输入：主机sftp://192.168.31.183和用户名、密码，就能建立连接，无需设置直接就是UTF-8编码，中文名文件上传到树莓派就不会发生乱码的问题。当然，也可以使用Sublime Text编辑器的SFTP插件，直接在编写代码的同时传输代码文件，非常方便。

## 4.2 控制中心主程序设计

### 4.2.1 整体程序框图

> 此处注重描述本机细节，网页应用直接是一个后续整体

􏱥􏱦􏲮􏰪􏲯􏰵􏲰􏲱􏱥􏱦􏲮􏰪􏲯􏰵􏲰􏲱系统总体工作流程图

### 4.2.2 程序控制流程

> 反正就是将如何读取数据和发送控制信号

先梳理一下思路：

- 传感器->PCF->树莓派（I2C）
- 传感器->arduino->树莓派（USB串口）
- 树莓派得到的只是数字电压的数值，首先需要转化为电压伏数
- 然后根据电压大小判断传感器的效果（不同传感器有不同的算法）
- 将换算过后的数据进行存储（直接放到log文件里面）

从上图可以看出，传感器采集数据之后会得到相应的电压数值，不同的传感器有不同的电压信号，如果是数字电压，例如数字温湿度传感器DHT11，则可以将DHT11的数字量输出接口直接连接至树莓派的GPIO口，树莓派可以通过相应的代码库Rpi.GPIO读取到数字化处理后的数值。如果是模拟电压，则有两种方式获得传感器的有效数字量，第一种方式是将传感器连接到PCF8591模数转换模块的模拟输入口，经PCF8591模块进行模数转换之后，再通过I2C总线将传感器值传输给树莓派。第二种方式是使用Arduino作为数据收集模块，Arduino既能读取数字信号，又能读取模拟信号，且由于更为底层的原因，效果往往比树莓派直接读取要好得多。例如MQ系列的气体物质传感器就是将模拟输出口连接至Arduino的模拟输入口，然后Arduino再将读取到的模拟量经数字化处理后通过串口的方式发送给树莓派。

树莓派得到相应的数字化处理的模拟电压量之后，将其转化为相应的电压伏值，根据不同的传感器参数计算出传感器电压值所代表的空气质量情况，从而推算出当前室内空气质量指数。与此同时，在完成一次传感器数据的收集之后，需要将有效数据存储到相应的记录文件中，以便于后续的网络应用能够直接读取到有效的数据，避免程序出错。

BCM2835

## 4.3 传感器数据读取

> 主要讲的是如何读取数据，比如CPU温度数据
> 
> 或者是读取电压值，之后才是有效数据转化

### 4.3.1 数据采集程序

> GPIO口的操作

针对于不同的传感器，有不同的方式进行数据的采集，下面将对温湿度传感器DHT11、MQ系列气体传感器、GP2Y1010AU粉尘传感器以及树莓派自带的工作状况分别进行介绍：

首先对于温湿度传感器DHT11来说，输出的是数字信号，可以直接通过Python模块RPi.GPIO直接读取树莓派的GPIO口从而得到数据。与此同时也可以使用Python代码调用子进程直接运行C语言模块，然后从shell中获取相应的输出结果，解析出所需要的温湿度数据。还有一种方法直接使用setup.py将dhtreader.c编译成一个dhtreader.so库，从而可以在Python代码中直接调用这个模块获得温湿度数据，这有点类似于LAB View中的C节点。

当然，相较于树莓派来说，Arduino更适合作为传感器数据的采集和处理，根据硬件时序图可以使用C语言编写相应的采集代码，直接在Arduino中运行。程序如下：

```cpp
#include "dht11.h"

// 此函数读取温度值，并且返回对应的读取状态：
// DHTLIB_OK
// DHTLIB_ERROR_CHECKSUM
// DHTLIB_ERROR_TIMEOUT
int dht11::read(int pin)
{
    uint8_t bits[5]; //存储读取的数据
    uint8_t cnt = 7; //计数器
    uint8_t idx = 0;

    //初始化数组为0
    for (int i=0; i< 5; i++) bits[i] = 0;

    //发送开始信号
    pinMode(pin, OUTPUT);//设置为输出
    digitalWrite(pin, LOW);//保持低电平至少18ms
    delay(18);
    digitalWrite(pin, HIGH);//保持高电平20-40us
    delayMicroseconds(40);
    //开始接受dht响应信号
    pinMode(pin, INPUT);//设置为输入

    unsigned int loopCnt = 10000;
    while(digitalRead(pin) == LOW)
        if (loopCnt-- == 0) return DHTLIB_ERROR_TIMEOUT;

    loopCnt = 10000;
    while(digitalRead(pin) == HIGH)
        if (loopCnt-- == 0) return DHTLIB_ERROR_TIMEOUT;

    // READ OUTPUT - 40 BITS => 5 BYTES or TIMEOUT
    //开始等待温度传感器回应（根据数据手册温度传感器回应时会拉低数据线）
    for (int i=0; i<40; i++)
    {
        //如果此时的电平和当前电平相等说明电平没有发生变化，所以继续等下一次循环
        loopCnt = 10000;
        while(digitalRead(pin) == LOW)
            if (loopCnt-- == 0) return DHTLIB_ERROR_TIMEOUT;

        unsigned long t = micros();

        loopCnt = 10000;
        while(digitalRead(pin) == HIGH)
            if (loopCnt-- == 0) return DHTLIB_ERROR_TIMEOUT;

        if ((micros() - t) > 40) bits[idx] |= (1 << cnt);//左移一位并且将数据1写入（此时最后一位为0）
        if (cnt == 0)   // 是否为下一个字节
        {
            cnt = 7;    // restart at MSB
            idx++;      // 下一个字节
        }
        else cnt--;
    }
    /*
    开始处理数据

    1.因为一次完整的数据输出为40位，所以j应大于40
    2.dht11_val[4]为校验和，此处判断校验和是否正确
    3.只打印dht11_val[0], dht11_val[2]是因为dht11_val[1], dht11_val[3]是小数部分，根据数据手册小数始终为零
    */
    // 写入正确的数据
    // 由于bits[1]和bits[3]总是0，所以就省略格式了
    humidity    = bits[0]; 
    temperature = bits[2]; 

    uint8_t sum = bits[0] + bits[2];  
    //校验正确，返回正确的状态码
    if (bits[4] != sum) return DHTLIB_ERROR_CHECKSUM;
    return DHTLIB_OK;
}
```

对于MQ系列气体传感器和GP2Y1010AU粉尘传感器来说，是直接将模拟信号发送到Arduino的模拟输入口。根据GP2Y1010AU粉尘传感器DataSheet中的脉冲周期图可知，需要在读取传感器输出值之前，开启内部的Led并等待280μs（微秒）。由于整个脉冲持续时间为320μs，因此还需要等待40μs才能将Led关闭。程序如下：

```c
int measurePin = 0;  // 连接模拟口0
int ledPower = 2;    // 连接数字口2

int samplingTime = 280;
int deltaTime = 40;
int sleepTime = 9680;
float voMeasured = 0;
float calcVoltage = 0;
float dustDensity = 0;

void setup(){
  Serial.begin(9600); //串口波特率设置成9600
  pinMode(ledPower,OUTPUT); //设置数字口为输出
  delay(1000); //给串口一定的准备时间
}

void loop(){
  digitalWrite(ledPower,LOW);              //开启内部LED
  delayMicroseconds(samplingTime);       // 开启LED后的280us的等待时间
  voMeasured = analogRead(measurePin);   // 读取模拟值
  delayMicroseconds(deltaTime);           //  40us等待时间
  digitalWrite(ledPower,HIGH);             // 关闭LED
  delayMicroseconds(sleepTime);

  int chk = DHT11.read(DHT11PIN);
  if (chk == DHTLIB_OK){ 
    Serial.print(voMeasured);//输出采集到的粉尘传感器电压
    Serial.print("-"); //设置分隔符，便于树莓派处理数据
    Serial.print(analogRead(1)); //输出MQ-2气体传感器的信号
    Serial.print("-");
    Serial.println(analogRead(2)); //输出MQ-2气体传感器的信号
  }
  delay(3000);
  Serial.flush();
}
```

与此同时，树莓派内置了一个传感器可以用来直接获取树莓派的CPU和GPU温度。这对于保护监控设备非常有用，当树莓派温度过高的时候可以设置关掉空气监控系统或者在温度过热的时候进行报警提醒。监控树莓派的CPU和GPU温度的python脚本如下：

```python
import commands
import os

def get_CPU_temp():
    CPU_temp_file = open( "/sys/class/thermal/thermal_zone0/temp" )
    CPU_temp = CPU_temp_file.read()
    CPU_temp_file.close()
    return float(CPU_temp)/1000

def get_GPU_temp():
    GPU_temp = commands.getoutput( '/opt/vc/bin/vcgencmd measure_temp' ).replace( 'temp=', '' ).replace( '\'C', '' )
    return float(GPU_temp)
```

### 4.3.2 模数转换程序

在本节中将介绍如何通过Python封装的smbus模块读取I2C总线所传输的数据，这个Python模块可以使得SMBus能够直接访问Linux主机的I2C /dev设备接口。SMBus是基于C-扩展cffi基础重新实现的Python版本，绑定到SMBus库的模块现在还是相当缓慢的加载模块。特别是对像树莓派这样的慢速设备，可能需要一点时间来加载SMBus模块。树莓派的Raspbian系统支持I2C和I2C设备接口，以及总线适配器驱动程序。但是在树莓派中，I2C被系统默认禁止，所以首先要解除I2C设备的限制。修改系统中的/etc/modprobe.d/raspi-blacklist.conf文件，将I2C和SPI驱动从黑名单中注释掉即可。与此同时打开/etc/modules配置文件进行修改，添加i2c-bcm2708和i2c-dev设备，重启树莓派就可以永久载入该设备。

然后通过apt-get的方式安装Python依赖库即python-smbus，以及i2c-tools工具，有了i2c-tools就可以直接使用i2cdetect命令：sudo i2cdetect -y -a查看总线上所挂载的所有设备。如图所示：UU为系统占用地址；48为PCF8591的地址，十六进制的，转换为二进制就是1001 000（根据硬件电路不同，末三位可能为000~111）。记下本步查询的结果0x48，如果查询结果只有UU，可能是硬件电路没有连接好。

```python
#Read a value from analogue input channel
#in A/D in the PCF8591P @ address 0x48
from smbus import SMBus
import time

bus = SMBus(1)

print("Read the A/D:")

def read_channel(sensor, channel):
    bus.write_byte(0x48, channel) # 设置寄存器读取通道
    reading = bus.read_byte(0x48) # 读取该通道的模拟量
    print "%s sensor | channel %s: %s"%(sensor, channel, reading)

while(1): # do forever
    read_channel("resistance", 0);
    read_channel("light", 1);
    read_channel("temprature", 2);
    read_channel("external", 3);
    print "*"*40
    time.sleep(2)
```

### 4.3.3 串口读取程序

作为一款优秀的开发平台，树莓派的确能够承担诸多外围设备，比如电机，LED等驱动功能，但是与此同时，对项目进行功能模块化也是非常重要的。毕竟树莓派的GPIO数目是一定的，扩展能力有限。所以在本次系统设计中也将介绍Arduino与树莓派如何进行通信，这样就可以有效地增加设备的输入输出的数量，而且能够减轻Raspberry Pi的负荷。

关于树莓派与Arduino Uno如何对接，实现方式至少有三种：USB方式对接、GPIO方式对接、I2C方式对接。本文将主要介绍如何使用USB-串口方式进行连接。首先在树莓派上安装Python的serial库，用于串口通信及USB通信，还可以安装串口调试工具minicom，可以非常方便得修改串口波特率等等。将Arduion通过USB转串口的线连接至树莓派的USB口，通过ls /dev/tty* 命令可以查找到挂载到树莓派上的USB设备端口，笔者使用的是/dev/ttyUSB0端口，这与网络上普遍所说的ttyACM0端口有所出入。

```python
import serial

port = '/dev/ttyUSB0' #设置串口的端口
arduino = serial.Serial(port,9600,timeout=1) #设置串口波特率
time.sleep(1.5) #给串口一定的准备时间
while (True):
    arduino.write("Everything is OK!")
    print ("Message from arduino: ")

    msg = arduino.readline().strip('\n\r') #读取arduino发送的数据
    print msg
    
    try:
        key = ['pm2.5', 'MQ-2', 'MQ-5', "hum", "temp", "PM2_5"]
        value = msg.split('-') #解析数据格式
        data = dict(zip(key,value)) #构造字典数据结构：{键:值}
        print data
    except:
        print 'ERROR!'

	#将传感器数据写入记录文件
    with open('../data/sensor.log', 'a') as f:
        if (len(data) == 6): #判断数据长度是否正确
            f.write(str(data) + '\n') #按行写入数据
            print "write success!"
        else:
            print "[ERROR:] write error!"

    print "*"*40
    time.sleep(3) #每3秒执行一次脚本
else:
    print "Exiting"
```

需要注意的是由于Arduino是单线程的，所以Arduino的串口通信是单信道。而且这里有2个时间延迟，第一个是做串口初始化等待，第二个是等待数据传输。简单地在树莓派和Arduino之间直接发送与接收来传递信息，存在信息丢包的现象。

## 4.4 空气质量数据处理

> 与前者不同的是侧重于获取数据之后的处理，比如

### 4.4.1 粉尘密度算法

GP2Y1010AU粉尘浓度传感器对于相当于香烟的烟雾检出物，可以按如下公式表示：

可以检出的范围（输出电压可变范围 (V) ）= 输出电压范围：VoH(V) — 无尘时输出电压：Voc(V)

将此换算成粉尘浓度：

检出粉尘浓度范围(mg/m3) = 检出可能范围（输出电压可变范围(V)） ÷ 检出感度：K(V/(0.1 mg/m3)

烟检出的情况下，其判定值如下：

判定值 = 检出浓度(mg/m3) ÷ 10 × K（V/(0.1 mg/m3)）+ 无尘时输出电压(V)

举个例子，当检出浓度为0.2(mg/m3) 来判定时，已知检出感度K为TYP 0.5 (V/(0.1 mg/m3)，无尘时输出电压为0.9 (V) 的情况下，判定值 = (0.2×10)×0.5+0.9 = 1.9 (V)

灰尘的检出则是在规定时间内，在某一输出电压变化的标准以上，判定在某一时间的输出被记入什么，从而检出灰尘的有无。

数据处理和计算程序的代码如下：

```python
def cal_vol(voMeasured):
    voMeasured = float(voMeasured)
    # 0 - 5V mapped to 0 - 1023 integer values
    # recover voltage
    cal_voltage = voMeasured * (5.0 / 1024.0)   #将模拟值转换为电压值
    return cal_voltage

def cal_den(cal_voltage):
    cal_voltage = float(cal_voltage)
    # linear eqaution taken from http:#www.howmuchsnow.com/arduino/airquality/
    # Chris Nafis (c) 2012
    dust_density = 0.17 * cal_voltage - 0.1      #将电压值转换为粉尘密度输出单位
    return float("%.6f"%(dust_density))  # 输出单位: 毫克/立方米

def cal_air_index(cal_voltage):
	#根据电压值计算颗粒数量
    air_index = (float(cal_voltage*5.0)-0.0356)*120000*0.035
    return air_index
```

### 4.4.2 空气质量评定

结合国外的一个对夏普GP2Y1010AU0F的烟雾实验，根据DataSheet图中所提供的颗粒浓度（毫克/平方米）与电压相对值的比较图，建立起输出电压与颗粒数量的对应关系：(V-0.0356)*120000

空气质量指数：

小颗粒读数（大于0.5微米）| 指数评定
-----------|----------
3000 +     | 很差很差
1050-3000  | 差
300-1050   | 还行
150-300    | 好
75-150     | 非常好
0-75       | 棒极了

借鉴于此思路，笔者也将MQ系列的气体物质传感器和室内温湿度结合起来，共同判断室内空气的整体状况。为了达到检测的空气质量评定的综合性以及减少单一传感器的偶然性误差，在数据处理时需要进行多传感器的数据融合，共同判定空气质量指数。以国家室内空气质量标准GB／TB8832002作为参考对数据融合后的数据进行模糊化处理。为每个传感器参数在其取值范围上定义3个概念（低、一般、高），选用梯形隶属度函数。PM2.5粉尘和甲醛作为人体健康主要的影响因素，需要将其语言值进行综合评定求出室内空气质量指数，相应的空气质量指数规则如表所示。

影响因素|   参数范围    | 影响权重
-------|--------------|---------
温度   |~21、22~28、29~|   2
湿度   |~35、36~70、71~|   1
PM2.5  |~300、301~1050、1050~| 3
烟雾   |~50、51~120、121~| 5
液化气 |~30、31~100、101~| 4

通过以上的数据处理可以为用户提供更加直观易懂的语言信息。根据不同的空气质量指数提供相应的提醒建议或者报警功能，如当空气中危险气体浓度将要超过标准数值时提醒用户开窗通风保持空气流通；当家居环境湿度过低时提醒用户注意保持空气湿润，并且会提出建议，提供能保持潮湿的有效措施，这样有助于保持人居健康环境；当出门在外的时候，家中如果发生煤气泄漏或者着火的情况，立刻发出警报提醒主人采取相应的应对措施。

与此同时，本次毕设的一个需要改进的地方就在于居室内某一个参数需要通过分布在居室不同空间位置的多个传感器进行数据采集。根据各个传感器终端节点具体的分布情况，同样使用求概率权的方法进行数据融合，所选权重不会受到主观因素的影响，可客观真实地反映各个传感器所测量数据。

# 第五章 接入互联网：网络应用开发

## 5.1 服务器搭建

### 5.1.1 网络架构

> 树莓派的网络连接，给出整体流程图框架
> 设备连接、作用

服务器系统架构图

### 5.1.2 HTTP协议

从一个整体上的角度来考虑现在的互联网通讯，计算机硬件资源就是生活的土地，驱动程序是地基，操作系统便是建筑物，应用程序就是生活在房子里的人们。与此同时，网络就可以类比成这样一个家庭和外界进行沟通的邮政系统，对亲朋好友的祝福与问候是书信的内容。而且，如果想要要合理地投送人们的真情惬意的话，就需要HTTP、IP/TCP或UDP等通信协议作为信封，将地址、发件人、收件人和时间等信息作为报头，而内容则还可以被封装起来。

因为所涉及的内容较多，这里仅仅就最常见的HTTP通信协议做简要介绍。HTTP协议（HyperText Transfer Protocol）即超文本传输协议是用于服务器传输到客户端浏览器的传输协议，HTTP是一个客户端和服务器端请求和响应的标准TCP，其实建立在TCP之上的。Web上，服务器和客户端利用HTTP协议进行通信会话。使用面向对象编程的思想来说的话就是：其会话的结构是一个简单的请求/响应序列，即浏览器发出请求和服务器做出响应。

TCP协议（Transmission Control Protocol）即传输控制协议是一种面向连接的、可靠的、基于字节流的传输层通信协议，TCP协议是面向连接的端到端的协议。因此，使用HTTP协议传输前，首先建立TCP连接，就是因此在谈的TCP链接过程的“三次握手”。UDP（User Datagram Protocol）即用户数据报协议，相比较而言，UDP协议只是简单的将信息打包按照目的地址往外传输。邮件只是简单的送到邮筒里面，任其自生自灭。在Web上，HTTP协议使用TCP协议而不是UDP协议的原因在于一个网页必须传送很多数据，而且保证其完整性。TCP协议提供传输控制，按顺序组织数据和错误纠正的一系列功能。IP（Internet Procotol）即网络通信协议，为计算机网络相互连接进行通信而设计的协议。简单来说就是，信封上面的发件人地址和收件人地址，或者说本机和目标机器在英特网上面的位置坐标。

### 5.1.3 内网穿透

> 为什么？原理

HTTP -> TCP -> IP

由于学校的网络连接处于校园网内部，也就是说树莓派处于局域网内，只能分配到一个内网IP。而微信开发模式中服务器配置要求填写公网IP，并且只允许80端口。这时需要ngrok进行内网穿透，使外网能够直接访问到树莓派。ngrok是一个反向代理的隧道工具，通过在公共的端点和本地运行的Web服务器之间建立一个安全的通道。ngrok可以捕获和分析所有通道上的流量，便于后期分析和重放。其原理是建立一个公网到localhost的基于TCP之上的端到端的隧道，让居于内网主机上的服务可以暴露给公网，俗称内网穿透。并且支持对隧道中数据的introspection（内省），支持可视化的观察隧道内数据，并replay（重放）相关请求（诸如HTTP请求）。因此ngrok可以很便捷的协助进行服务端程序调试，尤其在进行一些Web server开发中。ngrok更强大的一点是它支持tcp层之上的所有应用协议或者说与应用层协议无关。比如：你可以通过ngrok实现ssh登录到内网主机，也可以通过ngrok实现远程桌面(VNC)方式访问内网主机。

### 5.1.4 Web服务器

使用WSGI（Python Web Server Gateway Interface）能够确保web服务器兼容多个web框架的同时而又不用写代码来改变web服务器或者web框架。WSGI允许开发者分别选择web框架和web服务器，因此混合使用匹配的web框架和服务器来满足你的需求。web服务器必须实现WSGI的服务端接口，现在所有的Python web框架已经实现了WSGI的框架端接口，所以无需修改代码来适配一个特殊的web框架，服务端和框架开发者能够集中注意力于它们想关注的方面。下面是一个通过Flask框架搭建的最简单的web应用程序：

```python
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello Raspberry Pi!'

if __name__ == '__main__':
    app.run()
```

## 5.2 微信公众号开发

### 5.2.1 微信公众号简介



### 5.2.2 查询功能的实现

> 菜单栏设计，直接返回数据或者跳转网页

### 5.2.3 开发框架werobot

## 5.3 数据展示平台

### 5.3.1 yeelink平台简介

> 实现原理，对比国内外产品框架

### 5.3.2 传感器数据展示

> 图形页面展示

## 5.4 智能报警功能

### 5.4.1 突发情况判定

传感器距离火源的远近，对应的烟雾浓度将会不一样。距离远近，其在相同环境下烟雾浓度越大；距离越远，其在相同环境下烟雾浓度越小。所以必须要设置合适的烟雾浓度门限对应的电压值。MQ烟雾传感器对可燃气体有着很高的灵敏度，根据这一特性非常适合布置与厨房浴室等可燃气体易溢出的地方。



### 5.4.2 报警提示功能开发

> 由于微信公众号的API限制，最后还是做成发Email和微博

# 总结与展望

> 传感器分离，短距离通讯

# 致谢

在毕设项目进行之前，笔者就非常关注开源硬件与智能家居，对互联网行业有所向往，也曾设想未来的家居环境，在此项目极大得提高了我的动手能力

有多大的想象力，就可以做多少的事情。相较于单片机能做得更多。

如果不是树莓派的强大，也不可能在短时间内做出这样一个完善的东西。

# 参考文献

# 附录



